import{r as y,o as D,g as m,j as g,k as e,I as k,D as p,E as f,m as r,t as u,x,B as F,F as $}from"./index-48699524.js";import{i as v,g as M}from"./axios-instance-98f3073b.js";import{u as E}from"./tokenStore-a3ec96d9.js";import{r as L,s as i,n as S,S as j}from"./API-2a418714.js";import{C as N}from"./validate-9436c2bf.js";import{r as w}from"./PencilSquareIcon-f4c4e3fb.js";import{r as _}from"./BookmarkIcon-8d18ae53.js";const q={class:"divide-y divide-gray-200"},A={class:"grid max-w-7xl grid-cols-1 gap-x-8 gap-y-10 px-4 py-16 sm:px-6 md:grid-cols-3 lg:px-8"},B=e("div",null,[e("h2",{class:"text-base font-semibold leading-7 text-gray-700"},"Thông tin cá nhân"),e("p",{class:"mt-1 text-sm leading-6 text-gray-500"},"Cập nhật thông tin cá nhân liên quan đến tài khoản của bạn.")],-1),P=["onSubmit"],z={class:"grid grid-cols-1 gap-x-6 gap-y-8 sm:max-w-xl sm:grid-cols-6"},R={class:"col-span-full flex items-center gap-x-8"},G=["src"],Q=e("label",{for:"image-upload",class:"text-sm flex flex-col"},[e("span",{type:"submit",class:"rounded-md bg-indigo-600 mt-2 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 text-center w-20"}," Chọn ảnh "),e("span",null,"Lựa chọn ảnh đại diện")],-1),X={class:"sm:col-span-3"},H=e("label",{for:"id",class:"block text-sm font-medium leading-6 text-gray-700"},"Mã người dùng",-1),J={class:"mt-2"},K={class:"sm:col-span-3"},O=e("label",{for:"role",class:"block text-sm font-medium leading-6 text-gray-700"},"Quyền hạn",-1),W={class:"mt-2"},Y=["value"],Z={class:"col-span-full"},ee=e("label",{for:"username",class:"block text-sm font-medium leading-6 text-gray-700"},"Tên đăng nhập",-1),se={class:"mt-2"},ae={class:"col-span-full"},te={for:"fullname",class:"flex items-center gap-x-2 text-sm font-medium leading-6 text-gray-700"},oe=e("span",null,"Tên đầy đủ",-1),ne={class:"mt-2"},le={class:"mt-8 flex"},ie={key:0,type:"submit",class:"flex rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold gap-x-2 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},de={key:1,class:"flex rounded-md bg-gray-400 px-3 py-2 text-sm font-semibold gap-x-2 text-gray-300 shadow-sm"},re={class:"grid max-w-7xl grid-cols-1 gap-x-8 gap-y-10 px-4 py-16 sm:px-6 md:grid-cols-3 lg:px-8"},ue=e("div",null,[e("h2",{class:"text-base font-semibold leading-7 text-gray-700"},"Thay đổi mật khẩu"),e("p",{class:"mt-1 text-sm leading-6 text-gray-500"},"Cập nhật mật khẩu liên quan đến tài khoản của bạn.")],-1),ce=["onSubmit"],me={class:"grid grid-cols-1 gap-x-6 gap-y-8 sm:max-w-xl sm:grid-cols-6"},ge={class:"col-span-full"},pe={for:"current-password",class:"flex items-center gap-x-2 text-sm font-medium leading-6 text-gray-700"},fe=e("span",null,"Mật khẩu hiện tại",-1),he={class:"mt-2"},ve={class:"col-span-full"},xe={for:"new-password",class:"flex items-center gap-x-2 text-sm font-medium leading-6 text-gray-700"},we=e("span",null,"Mật khẩu mới",-1),_e={class:"mt-2"},ye={class:"col-span-full"},be={for:"confirm-password",class:"flex items-center gap-x-2 text-sm font-medium leading-6 text-gray-700"},ke=e("span",null,"Xác nhận mật khẩu",-1),Le={class:"mt-2"},Se={class:"mt-8 flex"},Te={key:0,type:"submit",class:"flex rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold gap-x-2 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},Ie={key:1,class:"flex rounded-md bg-gray-400 px-3 py-2 text-sm font-semibold gap-x-2 text-gray-300 shadow-sm"},Ce={key:0,class:"w-full h-full flex justify-center items-center",style:{position:"fixed",top:"0",left:"0","z-index":"100"}},Ue={class:"flex justify-center items-center"},Ve=e("div",{class:"bg-gray-500",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",opacity:"0.3"}},null,-1),De={class:"spinner-border text-white",role:"status"},Be={__name:"UserProfileEdit",setup(Fe){const b=y(!1),s=y({avatar:"",fileImage:null,fullname:"",password1:"",password2:"",password0:""}),n=y({id:1,role:1,username:"admin",fullname:"admin",avatar:"http://res.cloudinary.com/dbsfgxrjz/image/upload/v1701961064/admin-image/myeu6h3aquyqhg40d1qi.jpg"}),c=E();D(()=>{c.onSetCurrentPage({index:99,child:99}),s.value={avatar:"",fileImage:null,fullname:"",password1:"",password2:"",password0:""},T()});const T=async()=>{d(!0),await v.get(`${L}/${c.id}`).then(t=>{n.value=t.data.data,s.value.fullname=n.value.fullname,s.value.avatar=n.value.avatar,s.value.fileImage=null,s.value.password1="",s.value.password2="",s.value.password0=""}).catch(t=>{const a=t.response.data.message?t.response.data.message:"Lỗi";i(a,!0),console.error(a,t)}),d(!1)},I=async()=>{d(!0),await v.get(`${L}/${c.id}`).then(t=>{n.value=t.data.data,s.value.fullname=n.value.fullname,s.value.avatar=n.value.avatar,s.value.fileImage=null,c.onSetFullName(t.data.data.fullname),c.onSetAvatar(t.data.data.avatar)}).catch(t=>{const a=t.response.data.message?t.response.data.message:"Lỗi";i(a,!0),console.error(a,t)}),d(!1)},C=t=>{const a=t.target.files[0];if(a){s.value.fileImage=a;const o=new FileReader;o.onload=()=>{s.value.avatar=o.result},o.readAsDataURL(a)}},U=async()=>{const t=new FormData;let a=!1;if(s.value.fileImage&&(a=!0,t.append("avatar",s.value.fileImage)),s.value.fullname!=n.value.fullname)if(N(s.value.fullname))a=!0,t.append("fullname",s.value.fullname);else{i("Tên không đúng định dạng",!0);return}a&&(d(!0),await v.put(`${S}/${n.value.id}`,t).then(o=>{i("Cập nhật thành công",!1),I()}).catch(o=>{const l=o.response.data.message?o.response.data.message:"Lỗi";i(l,!0),console.error(l,o)}),d(!1))},V=async()=>{if(s.value.password1.toString().length==0||s.value.password2.toString().length==0||s.value.password0.toString().length==0){i("Dữ liệu bị thiếu",!0);return}if(s.value.password1!=s.value.password2){i("Mật khẩu không giống nhau");return}d(!0);const t=new FormData;t.append("password",s.value.password0),t.append("username",n.value.username);let a=!1;if(await v.post(j,t).then(l=>{c.onSetToken(l.data.data.token)}).catch(l=>{const h=l.response.data.message?l.response.data.message:"Lỗi";i(h,!0),console.error(h,l),a=!0}),a){i("Mật khẩu cũ không chính xác ",!0),d(!1);return}const o=new FormData;o.append("password",s.value.password1),await v.put(`${S}/${n.value.id}`,o).then(l=>{i("Cập nhật thành công",!1),s.value.password0="",s.value.password1="",s.value.password2=""}).catch(l=>{const h=l.response.data.message?l.response.data.message:"Lỗi";i(h,!0),console.error(h,l),console.error(l)}),d(!1)},d=t=>{b.value=t};return(t,a)=>(m(),g($,null,[e("div",null,[e("div",q,[e("div",A,[B,e("form",{class:"md:col-span-2",onSubmit:k(U,["prevent"])},[e("div",z,[e("div",R,[e("img",{src:s.value.avatar,alt:"avatar",class:"h-32 w-32 flex-none rounded-lg bg-gray-800 object-cover"},null,8,G),Q,e("input",{onChange:C,type:"file",id:"image-upload",accept:"image/*",class:"hidden"},null,32)]),e("div",X,[H,e("div",J,[p(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=o=>n.value.id=o),disabled:"",name:"id",id:"id",autocomplete:"id",class:"block w-full rounded-md border-0 bg-gray-100 py-1.5 text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6"},null,512),[[f,n.value.id]])])]),e("div",K,[O,e("div",W,[e("input",{type:"text",value:n.value.role==1?"admin":"nhân viên",disabled:"",name:"role",id:"role",autocomplete:"role",class:"block w-full rounded-md border-0 bg-gray-100 py-1.5 text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6"},null,8,Y)])]),e("div",Z,[ee,e("div",se,[p(e("input",{id:"username","onUpdate:modelValue":a[1]||(a[1]=o=>n.value.username=o),name:"username",type:"text",autocomplete:"username",disabled:"",class:"block w-full rounded-md border-0 bg-gray-100 py-1.5 text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6"},null,512),[[f,n.value.username]])])]),e("div",ae,[e("label",te,[oe,r(u(w),{class:"h-3.5 w-3.5"})]),e("div",ne,[p(e("input",{id:"fullname","onUpdate:modelValue":a[2]||(a[2]=o=>s.value.fullname=o),name:"fullname",type:"text",autocomplete:"fullname",class:"block w-full rounded-md border-0 bg-gray-100 py-1.5 text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6"},null,512),[[f,s.value.fullname]])])])]),e("div",le,[s.value.fileImage||s.value.fullname!=n.value.fullname?(m(),g("button",ie,[r(u(_),{class:"h-5 w-5","aria-hidden":"true"}),x(" Lưu ")])):(m(),g("span",de,[r(u(_),{class:"h-5 w-5","aria-hidden":"true"}),x(" Lưu ")]))])],40,P)]),e("div",re,[ue,e("form",{class:"md:col-span-2",onSubmit:k(V,["prevent"])},[e("div",me,[e("div",ge,[e("label",pe,[fe,r(u(w),{class:"h-3.5 w-3.5"})]),e("div",he,[p(e("input",{id:"current-password","onUpdate:modelValue":a[3]||(a[3]=o=>s.value.password0=o),name:"current_password",type:"password",autocomplete:"current-password",class:"block w-full rounded-md border-gray-300 bg-gray-100 py-1.5 text-gray-700 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[f,s.value.password0]])])]),e("div",ve,[e("label",xe,[we,r(u(w),{class:"h-3.5 w-3.5"})]),e("div",_e,[p(e("input",{id:"new-password",name:"new_password","onUpdate:modelValue":a[4]||(a[4]=o=>s.value.password1=o),type:"password",autocomplete:"new-password",class:"block w-full rounded-md border-gray-300 bg-gray-100 py-1.5 text-gray-700 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[f,s.value.password1]])])]),e("div",ye,[e("label",be,[ke,r(u(w),{class:"h-3.5 w-3.5"})]),e("div",Le,[p(e("input",{id:"confirm-password",name:"confirm_password","onUpdate:modelValue":a[5]||(a[5]=o=>s.value.password2=o),type:"password",autocomplete:"new-password",class:"block w-full rounded-md border-gray-300 bg-gray-100 py-1.5 text-gray-700 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[f,s.value.password2]])])])]),e("div",Se,[s.value.password1.length>0&&s.value.password2.length>0&&s.value.password0.length>0?(m(),g("button",Te,[r(u(_),{class:"h-5 w-5","aria-hidden":"true"}),x(" Lưu ")])):(m(),g("span",Ie,[r(u(_),{class:"h-5 w-5","aria-hidden":"true"}),x(" Lưu ")]))])],40,ce)])])]),b.value?(m(),g("div",Ce,[e("div",Ue,[Ve,e("div",De,[r(u(M),{color:"blue",size:"12",class:"lg:ml-64 mt-10"})])])])):F("",!0)],64))}};export{Be as default};
